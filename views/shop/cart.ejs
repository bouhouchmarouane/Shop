<%-include('../includes/head.ejs')%>
</head>
<body>
    <%-include('../includes/navigation.ejs')%>
    <main>
        <%if(items.length > 0) {%>
            <div class="columns">
                <div class="column is-half is-offset-one-quarter">
                    <div class="box">
                        <table class="table" style="width: 100%;">
                            <thead>
                            <tr>
                                <th>Title</th>
                                <th>Price</th>
                                <th>Quantity</th>
                                <th>Total</th>
                                <th></th>
                            </tr>
                            </thead>
                            <tbody>
                                <%let totalPrice = 0%>
                                <% items.forEach((item) => { %>
                                    <tr>
                                        <td><%=item.productId.title%></td>
                                        <td><%=item.productId.price%></td>
                                        <td><%=item.productId.quantity%></td>
                                        <th><%=item.quantity * item.productId.price%> MAD</th>
                                        <td>
                                            <button class="button is-danger is-outlined" style="float: right;" onclick="document.getElementById('deleteFromCart<%=item._id%>').submit()">
                                                <span>Delete</span>
                                                <span class="icon is-small">
                                                <i class="fas fa-times"></i>
                                                </span>
                                            </button>
                                            <form id="deleteFromCart<%=item._id%>" action="/delete-from-cart" method="POST">
                                                <input type="hidden" name="_csrf" value="<%=csrfToken%>">
                                                <input type="hidden" name="productId" value="<%=item.productId._id%>">
                                            </form>
                                        </td>
                                    </tr>
                                    <%totalPrice += item.quantity * item.productId.price %>
                                <%}) %>
                                <tr>
                                    <th colspan="3">Total</th>
                                    <th><%=totalPrice%> MAD</th>
                                </tr>
                            </tbody>
                        </table>
                        <form action="/create-order" method="POST">
                            <input type="hidden" name="_csrf" value="<%=csrfToken%>">
                            <button type="submit" class="button is-link">Checkout</button>
                        </form>
                    </div>
                </div>
            </div>
        <%} else {%>
            <h1>Cart is empty</h1>
        <%} %>
    </main>
</body> 
</html>