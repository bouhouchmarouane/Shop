<%-include('../includes/head.ejs')%>
</head>
<body>
    <%-include('../includes/navigation.ejs')%>
    <main>
        <%if(products.length > 0) {%>
            <% products.forEach((product, index) => { %>
                <%if(index % 5 == 0) { %>
                    <div class="columns">
                <%} %>
                <div class="column is-one-fifth">
                    <div class="card">
                        <div class="card-image">
                            <figure class="image is-4by3">
                                <img src="<%=product.imageUrl%>" alt="<%=product.title%>">
                            </figure>
                        </div>
                        <div class="card-content">
                            <p class="title is-4"><%=product.title%></p>
                            <p class="title is-3"><%=product.price%> MAD</p>
                            <div class="content"><div style="max-height: 70px; overflow: hidden;"><%=product.description%></div>...<a href="/product-details/<%=product._id%>">See more</a></div>
                        </div>
                        <footer class="card-footer">
                            <%if(isLoggedIn) {%>
                                <a href="javascript:document.getElementById('cartForm<%=product._id%>').submit()" class="card-footer-item">Add to cart</a>
                            <%}%>
                            <a href="/product-details/<%=product._id%>" class="card-footer-item">Details</a>
                        </footer>
                    </div>
                </div>
                <%if(index % 5 == 4 || index == products.length - 1) { %>
                    </div>
                <%} %>
                <%-include('../includes/add-to-cart-form.ejs', {productId: product._id})%>
            <%}) %>
            <div class="columns">
                <div class="column is-full">
                <nav class="pagination is-centered" role="navigation" aria-label="pagination">
                    <%if(hasPreviousPage) {%>
                        <a class="pagination-previous" href="?page=<%=previousPage %>">Previous</a>
                    <%} %>
                    <%if(hasNextPage) {%>
                        <a class="pagination-next" href="?page=<%=nextPage %>">Next page</a>
                    <%} %>
                    <ul class="pagination-list">
                        <%for(let i = 1; i <= totalPages; i++) {%>
                            <li><a href="?page=<%=i%>" class="pagination-link <%=i == page ? 'is-current' : ''%>" aria-label="Goto page <%=i%>"><%=i%></a></li>
                        <%} %>
                    </ul>
                </nav>
                </div>
            </div>         
        <%} else {%>
            <h2>No products found</h2>
        <%}%>
    </main>
</body>
</html>